# Migration `20201122171444`

This migration has been generated by Wadhah Mahrouk at 11/22/2020, 6:14:44 PM.
You can check out the [state of the schema](./schema.prisma) after the migration.

## Database Steps

```sql
CREATE TYPE "public"."Gender" AS ENUM ('male', 'female')

CREATE TABLE "Chapter" (
"id" SERIAL,
    "name" TEXT NOT NULL,
    "acronym" TEXT NOT NULL,

    PRIMARY KEY ("id")
)

CREATE TABLE "Member" (
    "id" TEXT NOT NULL,
    "name" TEXT NOT NULL,
    "lastname" TEXT NOT NULL,
    "gender" "Gender",
    "fbLink" TEXT,
    "phone" INTEGER,
    "email" TEXT,

    PRIMARY KEY ("id")
)

CREATE TABLE "IEEEAccount" (
    "id" INTEGER NOT NULL,
    "email" TEXT NOT NULL,
    "registrationDate" TIMESTAMP(3),
    "memberId" TEXT NOT NULL,

    PRIMARY KEY ("id")
)

CREATE TABLE "Partner" (
"id" SERIAL,
    "name" TEXT NOT NULL,
    "code" TEXT NOT NULL,
    "email" TEXT NOT NULL,
    "active" BOOLEAN NOT NULL DEFAULT true,
    "rate" INTEGER,

    PRIMARY KEY ("id")
)

CREATE TABLE "QrScan" (
"id" SERIAL,
    "date" TIMESTAMP(3) NOT NULL,
    "memberId" TEXT NOT NULL,
    "partnerId" INTEGER NOT NULL,

    PRIMARY KEY ("id")
)

CREATE TABLE "_ChapterToMember" (
    "A" INTEGER NOT NULL,
    "B" TEXT NOT NULL
)

CREATE UNIQUE INDEX "Chapter.name_unique" ON "Chapter"("name")

CREATE UNIQUE INDEX "Chapter.acronym_unique" ON "Chapter"("acronym")

CREATE UNIQUE INDEX "Member.fbLink_unique" ON "Member"("fbLink")

CREATE UNIQUE INDEX "Member.phone_unique" ON "Member"("phone")

CREATE UNIQUE INDEX "Member.email_unique" ON "Member"("email")

CREATE UNIQUE INDEX "IEEEAccount.email_unique" ON "IEEEAccount"("email")

CREATE UNIQUE INDEX "IEEEAccount_memberId_unique" ON "IEEEAccount"("memberId")

CREATE UNIQUE INDEX "Partner.code_unique" ON "Partner"("code")

CREATE UNIQUE INDEX "Partner.email_unique" ON "Partner"("email")

CREATE UNIQUE INDEX "_ChapterToMember_AB_unique" ON "_ChapterToMember"("A", "B")

CREATE INDEX "_ChapterToMember_B_index" ON "_ChapterToMember"("B")

ALTER TABLE "IEEEAccount" ADD FOREIGN KEY("memberId")REFERENCES "Member"("id") ON DELETE CASCADE ON UPDATE CASCADE

ALTER TABLE "QrScan" ADD FOREIGN KEY("memberId")REFERENCES "Member"("id") ON DELETE CASCADE ON UPDATE CASCADE

ALTER TABLE "QrScan" ADD FOREIGN KEY("partnerId")REFERENCES "Partner"("id") ON DELETE CASCADE ON UPDATE CASCADE

ALTER TABLE "_ChapterToMember" ADD FOREIGN KEY("A")REFERENCES "Chapter"("id") ON DELETE CASCADE ON UPDATE CASCADE

ALTER TABLE "_ChapterToMember" ADD FOREIGN KEY("B")REFERENCES "Member"("id") ON DELETE CASCADE ON UPDATE CASCADE
```

## Changes

```diff
diff --git schema.prisma schema.prisma
migration 20201118103450..20201122171444
--- datamodel.dml
+++ datamodel.dml
@@ -1,7 +1,7 @@
 datasource db {
   provider = "postgresql"
-  url = "***"
+  url = "***"
 }
 generator client {
   provider = "prisma-client-js"
@@ -14,9 +14,9 @@
   members Member[]
 }
 model Member {
-  id          Int          @id @default(autoincrement())
+  id          String       @id @default(uuid())
   name        String
   lastname    String
   gender      Gender?
   fbLink      String?      @unique
@@ -31,9 +31,9 @@
   id               Int       @id
   email            String    @unique
   registrationDate DateTime?
   member           Member    @relation(fields: [memberId], references: [id])
-  memberId         Int
+  memberId         String
 }
 model Partner {
   id      Int      @id @default(autoincrement())
@@ -49,9 +49,9 @@
   id        Int      @id @default(autoincrement())
   member    Member   @relation(fields: [memberId], references: [id])
   partner   Partner  @relation(fields: [partnerId], references: [id])
   date      DateTime
-  memberId  Int
+  memberId  String
   partnerId Int
 }
 enum Gender {
```


